import { useState, useRef } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Check, X } from "lucide-react";

interface Question {
  text: string;
  correct: "juist" | "fout";
  explanation: string;
}

const QUESTIONS: Question[] = [
  {
    text: "1. Planeten kan je nooit zien want ze geven geen licht.",
    correct: "fout",
    explanation:
      "Planeten weerkaatsen zonlicht; daardoor kun je ze toch zien (bv. Venus, Jupiter).",
  },
  {
    text: "2. Onze zon en onze planeten zijn ontstaan met de “big bang”.",
    correct: "fout",
    explanation:
      "De Big Bang was 13,8 miljard jaar geleden; ons zonnestelsel ontstond pas 4,6 miljard jaar geleden uit een lokale nevel.",
  },
  {
    text: "3. Een vallende ster is een ster die naar de aarde valt.",
    correct: "fout",
    explanation:
      "Een vallende ster is een meteoor – een klein stukje steen of stof dat opbrandt in de atmosfeer.",
  },
  {
    text: "4. In de woestijn kan je veel meer sterren zien dan op een wolkeloze nacht in België.",
    correct: "juist",
    explanation:
      "Daar is vrijwel geen lichtvervuiling en de lucht is droog en helder, waardoor zwakkere sterren zichtbaar worden.",
  },
  {
    text: "5. De kans is groot dat er leven is in de ruimte. De kans dat we er naartoe kunnen is met de huidige kennis onmogelijk.",
    correct: "juist",
    explanation:
      "Statistisch lijken exoplaneten met leven waarschijnlijk, maar interstellaire reizen zijn met huidige voortstuwing onhaalbaar binnen een mensenleven.",
  },
  {
    text: "6. Binnen een mensenleven kan je met de huidige technologie niet tot aan de verste planeten van ons zonnestelsel reizen.",
    correct: "fout",
    explanation:
      "Voyager 2 bereikte Neptunus in 12 jaar; New Horizons bereikte Pluto in 9,5 jaar – dus wel degelijk mogelijk binnen één leven.",
  },
  {
    text: "7. Op het zuidelijk halfrond zit de zon ’s middags in het noorden.",
    correct: "juist",
    explanation:
      "Omdat de zon ten noorden van de waarnemer over de hemel gaat, staat ze rond het middaguur in het noorden.",
  },
  {
    text: "8. Als de zon zou uitdoven duurt het meer dan een uur alvorens het hier donker zou worden.",
    correct: "fout",
    explanation:
      "Zonlicht doet slechts 8 minuten en 20 seconden over de afstand naar de Aarde.",
  },
  {
    text: "9. Een zwart gat is een planeet die alles opslokt.",
    correct: "fout",
    explanation:
      "Een zwart gat is de supercompacte overblijfsel van een zware ster, geen planeet.",
  },
  {
    text: "10. 21 juni is voor iedereen op aarde de langste dag van het jaar.",
    correct: "fout",
    explanation:
      "Alleen op het noordelijk halfrond is 21 juni de langste dag; op het zuidelijk halfrond juist de kortste.",
  },
];

export default function KosmoQuizApp() {
  const [index, setIndex] = useState(0);
  const [feedback, setFeedback] = useState<null | "correct" | "wrong">(null);
  const [score, setScore] = useState(0);

  // Geluidsbestanden
  const correctSound = useRef<HTMLAudioElement | null>(null);
  const wrongSound = useRef<HTMLAudioElement | null>(null);

  if (!correctSound.current) correctSound.current = new Audio("/sounds/correct.mp3");
  if (!wrongSound.current) wrongSound.current = new Audio("/sounds/wrong.mp3");

  const current = QUESTIONS[index];

  function handleAnswer(choice: "juist" | "fout") {
    const isCorrect = choice === current.correct;
    setFeedback(isCorrect ? "correct" : "wrong");
    if (isCorrect) setScore((s) => s + 1);

    const audio = isCorrect ? correctSound.current! : wrongSound.current!;
    audio.currentTime = 0;
    audio.play();
  }

  function nextQuestion() {
    setFeedback(null);
    setIndex((i) => i + 1);
  }

  function restart() {
    setIndex(0);
    setFeedback(null);
    setScore(0);
  }

  const fbStyle =
    feedback === "correct"
      ? "bg-green-100 text-green-800 border-green-300"
      : "bg-orange-100 text-orange-800 border-orange-300";

  return (
    <div className="flex flex-col items-center justify-center min-h-screen gap-6 p-4 bg-gradient-to-br from-indigo-50 via-sky-50 to-emerald-50">
      <Card className="w-full max-w-xl shadow-2xl rounded-2xl border-0">
        <CardContent className="p-8 space-y-8">
          {index < QUESTIONS.length ? (
            <>
              <h1 className="text-3xl font-bold text-indigo-700">KosmoQuiz</h1>

              {/* Vraag */}
              <p className="text-xl font-medium text-gray-800 min-h-[72px] flex items-center">
                {current.text}
              </p>

              {/* Antwoordknoppen */}
              {!feedback && (
                <div className="flex gap-4 justify-center">
                  <Button
                    className="bg-green-600 hover:bg-green-700 text-white rounded-xl px-6 py-3 text-lg"
                    onClick={() => handleAnswer("juist")}
                  >
                    Juist
                  </Button>
                  <Button
                    className="bg-orange-600 hover:bg-orange-700 text-white rounded-xl px-6 py-3 text-lg"
                    onClick={() => handleAnswer("fout")}
                  >
                    Fout
                  </Button>
                </div>
              )}

              {/* Feedback */}
              {feedback && (
                <div className={`space-y-4 p-4 border rounded-xl ${fbStyle}`}>
                  <div className="flex items-center gap-2 text-2xl font-semibold">
                    {feedback === "correct" ? <Check className="w-7 h-7" /> : <X className="w-7 h-7" />} 
                    <span>{feedback === "correct" ? "Correct!" : "Helaas, fout."}</span>
                  </div>
                  <p className="text-base leading-relaxed">{current.explanation}</p>
                  <Button
                    onClick={nextQuestion}
                    className="bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl"
                  >
                    {index === QUESTIONS.length - 1 ? "Resultaat" : "Volgende vraag"}
                  </Button>
                </div>
              )}
            </>
          ) : (
            <>
              <h1 className="text-3xl font-bold text-indigo-700">Quiz voltooid!</h1>
              <p className="text-xl text-gray-800">Je score: {score}/10</p>
              <Button onClick={restart} className="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl">
                Opnieuw spelen
              </Button>
            </>
          )}
        </CardContent>
      </Card>

      {/* Preload audio */}
      <audio src="/sounds/correct.mp3" preload="auto" />
      <audio src="/sounds/wrong.mp3" preload="auto" />
    </div>
  );
}
